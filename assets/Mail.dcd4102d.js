import{d as ae,r as a,a as le,c as ne,o as re,b as g,e,F as U,f as $,w as N,v as ie,g as d,h,l as S,i as w,j as D,t as C,k,n as de,u as ce,m as me}from"./index.0dd71782.js";import{h as Y,f as x,a as pe}from"./firebaseConfig.10f39527.js";const V={_origin:"https://api.emailjs.com"},ve=(l,o="https://api.emailjs.com")=>{V._userID=l,V._origin=o},L=(l,o,v)=>{if(!l)throw"The user ID is required. Visit https://dashboard.emailjs.com/admin/integration";if(!o)throw"The service ID is required. Visit https://dashboard.emailjs.com/admin";if(!v)throw"The template ID is required. Visit https://dashboard.emailjs.com/admin/templates";return!0};class j{constructor(o){this.status=o.status,this.text=o.responseText}}const P=(l,o,v={})=>new Promise((A,_)=>{const c=new XMLHttpRequest;c.addEventListener("load",({target:r})=>{const f=new j(r);f.status===200||f.text==="OK"?A(f):_(f)}),c.addEventListener("error",({target:r})=>{_(new j(r))}),c.open("POST",V._origin+l,!0),Object.keys(v).forEach(r=>{c.setRequestHeader(r,v[r])}),c.send(o)}),_e=(l,o,v,A)=>{const _=A||V._userID;L(_,l,o);const c={lib_version:"3.2.0",user_id:_,service_id:l,template_id:o,template_params:v};return P("/api/v1.0/email/send",JSON.stringify(c),{"Content-type":"application/json"})},fe=l=>{let o;if(typeof l=="string"?o=document.querySelector(l):o=l,!o||o.nodeName!=="FORM")throw"The 3rd parameter is expected to be the HTML form element or the style selector of form";return o},he=(l,o,v,A)=>{const _=A||V._userID,c=fe(v);L(_,l,o);const r=new FormData(c);return r.append("lib_version","3.2.0"),r.append("service_id",l),r.append("template_id",o),r.append("user_id",_),P("/api/v1.0/email/send-form",r)},Fe={init:ve,send:_e,sendForm:he},Ce={class:"tofu-area"},Ae={class:"menu"},ge=["onClick"],De=e("span",null,"\u5143",-1),ye=e("i",{class:"fa-solid fa-circle-plus"},null,-1),be=e("div",{class:"cart_sun"},[e("h4",null,"\u5916\u5E36\u81EA\u53D6\u8CFC\u7269\u8ECA"),e("p",null,"\u8ACB\u65BC\u8A02\u99101\u5C0F\u6642\u4E4B\u5167\u4F86\u96FB\u9818\u53D6\u8CFC\u7269\u9805\u76EE\uFF0C\u8B1D\u8B1D\u60A8\u7684\u5408\u4F5C\uFF01"),e("p",null,"\u672C\u5E97\u63A1\u73FE\u91D1\u4EA4\u6613\uFF01")],-1),Be={class:"menu_shop"},Ee=e("div",{class:"order_content_headline"},"\u8A02\u8CFC\u5167\u5BB9\uFF1A",-1),we={class:"form-area"},ke={class:"cartAll"},Ve={class:"cart-item"},Te={class:"cart-title"},Se={class:"price"},xe={class:"count"},Me={class:"count"},Oe={class:"handler"},Ue=["onClick"],$e=["onClick"],qe=["onClick"],He=["onClick"],Ne={class:"countAllTotal"},Ye={style:{display:"none"},name:"AllTotal"},je={class:"order_info"},Le=e("div",{class:"headline"},"\u8A02\u8CFC\u4EBA\u8CC7\u6599\uFF1A",-1),Pe={class:"el-dialog__body"},Re=e("div",null,"\u8ACB\u60A8\u5728\u9810\u5B9A\u6642\u9593\u5167\u5B8C\u6210\u8A02\u55AE\u4EA4\u6613\uFF01\u611F\u8B1D\u60A8\u7684\u5408\u4F5C\uFF01",-1),ze={class:"dialog-footer"},We=ae({__name:"Mail",setup(l){const o=a(""),v=a(""),A=a(""),_=a(""),c=a(""),r=a(),f=a(!1),T=a(),q=a(!1),n=a([]),y=a(Y(new Date).format("YYYY-MM-DD-HHmmssSSS")),m=a({name:"",email:"",phone:"",date:"",time:"",type:""}),H=a(),R=le({name:[{required:!0,message:"\u8ACB\u8F38\u5165\u60A8\u7684\u59D3\u540D",trigger:"blur"}],email:[{required:!0,message:"\u8ACB\u8F38\u5165\u60A8\u7684email",trigger:"blur"}],phone:[{required:!0,message:"\u8ACB\u8F38\u5165\u60A8\u7684\u884C\u52D5\u96FB\u8A71",trigger:"blur"}]});var z=x.database().ref("orders/");const K=a({}),Q=()=>{z.once("value",t=>{K.value=t.val()})};a({id:"",productName:"",price:"",count:"",total:""});const W=a(),X=t=>{try{const s={NumberDate:y,form_name:o,form_email:v,form_phone:A,form_time:_,form_type:c,AllTotal:r};Fe.sendForm("service_v77i5ep","template_jqd9wwu",t.target,"aQibbyOFShdl2H3vj",s)}catch(s){console.log({error:s})}},J=()=>{f.value=!0},Z=async(t,s)=>{if(!!s){var p=x.database().ref("user/"),i=x.database().ref("orders/");x.database().ref("orders/list/"),await s.validate((F,b)=>{F&&(p.push({orderUser:m.value}),i.push({orderNo:y.value,orderUser:m.value,time:Y(new Date).format("YYYY-MM-DD HH:mm"),countTotal:M.value,list:n.value}),J(y.value,W.value,m.value,M.value))})}},G=async()=>{const p="https://sheets.googleapis.com/v4/spreadsheets/19YWnM9PrXXEUOcT9zWkQYpiZ1W3o6i-UToEGsUPcFcU/values/\u5546\u54C1\u5217\u8868?alt=json&key=AIzaSyAieT4Folrx3Tsx-iZqzu_HyNBt349BMaw";await pe.get(p).then(i=>{T.value=i.data.values;for(var F=0;F<=T.value.length;F++)for(var b=T.value[0],E=0;E<=b.length;E++)b[E]})},I=a(),ee=t=>{var s=[];s[0]=t[0],console.log("\u6293\u5546\u54C1id",s[0]),I.value=s[0],s[1]=t[1],s[2]=t[2];var p=1;for(var i in n.value)if(n.value[i][1]===t[1]){p=n.value[i][3]+1;var F=n.value.indexOf(n.value[i]);n.value.splice(F,1)}s[3]=p,n.value.push(s),console.log("\u8A02\u8CFC\u55AE\u6578\u91CF",n.value.length),n.value.length>0&&(q.value=!0)},se=t=>{t[3]++};a([]);const ue=t=>{console.log("removeOne",t),t[3]--,t[3]<=0&&n.value.splice(t,1)},te=t=>{n.value.splice(t,1)},M=ne(()=>{var t=0;for(var s in n.value)t+=n.value[s][3]*n.value[s][2];return t});return re(()=>{G(),Q()}),(t,s)=>{const p=w("el-input"),i=w("el-form-item"),F=w("el-form"),b=w("el-button"),E=w("el-dialog"),oe=me("modal");return D(),g("div",Ce,[e("ul",Ae,[(D(!0),g(U,null,$(T.value,u=>(D(),g("li",{key:u},[e("a",{onClick:B=>ee(u)},[(D(!0),g(U,null,$(u,B=>(D(),g("div",{key:B},[e("span",null,C(B),1)]))),128)),De,ye],8,ge)]))),128))]),N(e("div",null,[be,e("div",Be,[d(F,{ref_key:"ruleFormRef",ref:H,onSubmit:S(X,["prevent"]),model:m.value,rules:R,"status-icon":""},{default:h(()=>[Ee,e("div",we,[e("div",ke,[(D(!0),g(U,null,$(n.value,(u,B)=>(D(),g("div",{class:"cart",key:B},[e("div",Ve,[e("div",Te,C(u[1]),1),e("div",null,[e("span",Se,C("$"+u[2]),1),k(" x "),e("span",xe,C(u[3]),1),e("span",Me,C("$"+u[2]*u[3]),1)]),e("div",Oe,[e("i",{onClick:S(O=>se(u),["prevent"]),class:"fa-solid fa-circle-plus"},null,8,Ue),e("i",{onClick:S(O=>ue(u),["prevent"]),class:"fa-solid fa-circle-minus ml-2"},null,8,$e),e("i",{onClick:S(O=>te(u),["prevent"]),class:"fa-solid fa-trash"},null,8,qe)])]),e("input",{class:de("btn"+B+1),onClick:O=>Z(u,H.value),type:"submit",value:"\u9001\u51FA\u8CFC\u7269\u8ECA"},null,10,He)]))),128))]),e("p",Ne,[k("\u7E3D\u8A08\uFF1A "),e("span",null,[k(C("$"+ce(M))+" ",1),N(e("input",Ye,null,512),[[oe,r.value]])])]),e("div",je,[Le,d(i,{style:{display:"none"}},{default:h(()=>[d(p,{name:"NumberDate",modelValue:y.value,"onUpdate:modelValue":s[0]||(s[0]=u=>y.value=u),type:"text"},null,8,["modelValue"])]),_:1}),d(i,{label:"\u59D3\u540D",prop:"name"},{default:h(()=>[d(p,{name:"form_name",modelValue:m.value.name,"onUpdate:modelValue":s[1]||(s[1]=u=>m.value.name=u),placeholder:"\u8ACB\u8F38\u5165\u4F60\u7684email",type:"test"},null,8,["modelValue"])]),_:1}),d(i,{label:"email",prop:"email"},{default:h(()=>[d(p,{name:"form_email",modelValue:m.value.email,"onUpdate:modelValue":s[2]||(s[2]=u=>m.value.email=u),placeholder:"\u8ACB\u8F38\u5165\u4F60\u7684email",type:"email"},null,8,["modelValue"])]),_:1}),d(i,{label:"\u884C\u52D5\u96FB\u8A71",prop:"phone"},{default:h(()=>[d(p,{name:"form_phone",modelValue:m.value.phone,"onUpdate:modelValue":s[3]||(s[3]=u=>m.value.phone=u),placeholder:"\u8ACB\u8F38\u5165\u4F60\u7684\u884C\u52D5\u96FB\u8A71",type:"text"},null,8,["modelValue"])]),_:1})])])]),_:1},8,["onSubmit","model","rules"])])],512),[[ie,q.value]]),d(E,{class:"addmodal",modelValue:f.value,"onUpdate:modelValue":s[6]||(s[6]=u=>f.value=u),title:"\u8A02\u55AE\u8CC7\u8A0A",width:"30%",center:""},{footer:h(()=>[e("span",ze,[d(b,{onClick:s[4]||(s[4]=u=>f.value=!1)},{default:h(()=>[k("\u95DC\u9589\u8996\u7A97")]),_:1}),d(b,{type:"primary",onClick:s[5]||(s[5]=u=>f.value=!1)},{default:h(()=>[k(" \u8A02\u55AE\u5B8C\u6210 ")]),_:1})])]),default:h(()=>[e("div",Pe,[e("div",null,C(m.value.name)+" \u5148\u751F / \u5C0F\u59D0\uFF0C\u60A8\u597D\uFF1A ",1),e("div",null,"\u8A02\u55AE\u7DE8\u865F\uFF1A"+C(y.value),1),Re])]),_:1},8,["modelValue"])])}}});export{We as default};
